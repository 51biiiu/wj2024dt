<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>闲闲发布闲置</title>
		<link rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
		<link rel="stylesheet" href="https://cdn.staticfile.net/twitter-bootstrap/5.1.1/css/bootstrap.min.css">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
		<script src="https://cdn.staticfile.net/twitter-bootstrap/5.1.1/js/bootstrap.bundle.min.js"></script>

		<link rel="stylesheet" href="../css/app.css">
		<style>
			/* 顶部导航样式 */
			.csttop {
				height: 80px;
			}

			/* 发布表单主体样式 */
			.publish-container {
				background-color: #F8F9FB;
				padding: 30px;
				margin: 20px auto;
				width: 100%;
				max-width: 900px;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
			}

			/* 模块标题样式 */
			.form-module {
				margin-bottom: 30px;
				padding-bottom: 15px;
				border-bottom: 1px solid #eee;
			}

			.form-module h3 {
				font-size: 18px;
				color: #333;
				margin-bottom: 15px;
				display: flex;
				align-items: center;
			}

			.form-module h3 i {
				margin-right: 8px;
				color: #0d6efd;
			}

			/* 表单标签提示 */
			.form-label {
				font-weight: 500;
				color: #444;
			}

			.form-text {
				font-size: 13px;
				color: #666;
			}

			/* 分类选择区域样式 */
			.category-select {
				display: flex;
				gap: 15px;
				align-items: center;
				margin-bottom: 10px;
			}

			.category-select .form-select {
				flex: 1;
			}

			.reselect-btn {
				padding: 0.375rem 0.75rem;
				font-size: 0.875rem;
			}

			/* 新旧程度说明样式 */
			.condition-desc {
				margin-top: 8px;
				padding: 8px 12px;
				background-color: #e6f2ff;
				border-radius: 4px;
				font-size: 14px;
				color: #0d6efd;
				display: none;
				/* 默认隐藏，选择后显示 */
			}

			/* 价格输入区域样式 */
			.price-group {
				display: flex;
				gap: 15px;
			}

			.price-group .form-floating {
				flex: 1;
			}

			/* 议价开关样式 */
			.bargain-switch {
				display: flex;
				align-items: center;
				gap: 10px;
				margin-top: 15px;
			}

			/* 图文描述区域样式 */
			.editor-toolbar {
				display: flex;
				gap: 10px;
				padding: 8px 12px;
				background-color: #f8f9fa;
				border: 1px solid #dee2e6;
				border-bottom: none;
				border-radius: 4px 4px 0 0;
			}

			.editor-toolbar button {
				background: transparent;
				border: none;
				color: #666;
				cursor: pointer;
				padding: 4px 8px;
				border-radius: 2px;
			}

			.editor-toolbar button:hover {
				background-color: #e9ecef;
			}

			#descEditor {
				min-height: 150px;
				resize: vertical;
			}

			/* 图片上传区域样式 */
			.img-upload-area {
				border: 2px dashed #ddd;
				border-radius: 4px;
				padding: 20px;
				text-align: center;
				margin-top: 10px;
				cursor: pointer;
				transition: border-color 0.3s;
			}

			.img-upload-area:hover {
				border-color: #0d6efd;
			}

			.img-upload-area i {
				font-size: 24px;
				color: #888;
				margin-bottom: 8px;
			}

			.img-upload-area p {
				color: #666;
				margin: 0;
				font-size: 14px;
			}

			#imgUpload {
				display: none;
			}

			.uploaded-imgs {
				display: flex;
				gap: 10px;
				margin-top: 15px;
				flex-wrap: wrap;
			}

			.uploaded-img-item {
				width: 100px;
				height: 100px;
				position: relative;
				border-radius: 4px;
				overflow: hidden;
				border: 1px solid #eee;
			}

			.uploaded-img-item img {
				width: 100%;
				height: 100%;
				object-fit: cover;
			}

			.img-delete {
				position: absolute;
				top: -8px;
				right: -8px;
				width: 20px;
				height: 20px;
				border-radius: 50%;
				background-color: #ff4d4f;
				color: white;
				font-size: 12px;
				display: flex;
				align-items: center;
				justify-content: center;
				cursor: pointer;
				border: none;
			}

			/* 提交按钮样式 */
			.submit-btn-area {
				text-align: center;
				margin-top: 40px;
			}

			.submit-btn {
				padding: 8px 40px;
				font-size: 16px;
			}
		</style>
	</head>
	<body>
		<!-- 顶部导航 -->
		<div style="background-color: #ffe60f" class="container-fluid csttop">
			<div class="d-flex w-100 h-100 justify-content-center align-items-center">
				<div class="cstlogo d-flex w-100 h-100 align-items-center">
					<img src="../img/logo.png" alt="闲闲logo" style="height: 40px;">
					<img src="../img/logo.png" alt="闲闲logo" style="height: 40px; margin-left: 10px;">
				</div>
				<div class="cstsearch fs-5 fw-medium">——发布闲置</div>
				<div class="ms-auto me-4">
					<a href="./landing.html" class="text-dark me-3"><i class="fa fa-arrow-left"></i> 返回首页</a>
				</div>
			</div>
		</div>

		<!-- 发布表单主体 -->
		<div class="publish-container container">
			<form id="publishForm" onsubmit="return submitPublish()">
				<!-- 1. 商品信息填写模块 -->
				<div class="form-module">
					<h3><i class="fa fa-list-alt"></i> 1. 填写商品信息</h3>

					<!-- 分类选择（一级+二级） -->
					<div class="mb-3">
						<label class="form-label" for="firstCategory">商品分类 <span class="text-danger">*</span></label>
						<div class="category-select">
							<select class="form-select" id="firstCategory" required onchange="loadSecondCategory()">
								<option value="">请选择一级分类</option>
								<option value="textbook">教材教辅</option>
								<option value="electronic">电子产品</option>
								<option value="clothes">服饰鞋包</option>
								<option value="daily">日用百货</option>
								<option value="sports">运动器材</option>
							</select>
							<select class="form-select" id="secondCategory" required disabled>
								<option value="">请先选择二级分类</option>
							</select>
							<button type="button" class="btn btn-outline-secondary reselect-btn"
								onclick="resetCategory()">重新选择</button>
						</div>
						<div class="form-text">从一级分类到二级分类逐级选择，选错可点击“重新选择”修改</div>
					</div>

					<!-- 商品标题 -->
					<div class="mb-3">
						<label class="form-label" for="goodsTitle">商品标题 <span class="text-danger">*</span></label>
						<input type="text" class="form-control" id="goodsTitle" maxlength="30" required
							placeholder="包含关键信息，如“23版高数教材（无笔记）”">
						<div class="form-text">最多30字，建议包含商品核心属性（版本、新旧、有无瑕疵等）</div>
						<div id="titleLength" class="form-text text-right">0/30</div>
					</div>

					<!-- 商品图文描述 -->
					<div class="mb-3">
						<label class="form-label" for="descEditor">商品描述 <span class="text-danger">*</span></label>
						<!-- 简易编辑器工具栏 -->
						<div class="editor-toolbar">
							<label for="imgUpload" class="mb-0"><i class="fa fa-image"></i> 插入图片</label>
						</div>
						<!-- 描述输入框 -->
						<textarea class="form-control" id="descEditor" required
							placeholder="说明新旧程度、使用情况、瑕疵等，如“9成新，封面有轻微折痕”"></textarea>
						<div class="form-text">建议详细描述商品细节，帮助买家快速了解</div>

						<!-- 图片上传区域 -->
						<label for="imgUpload" class="img-upload-area">
							<i class="fa fa-cloud-upload"></i>
							<p>点击上传商品图片（最多5张，支持JPG/PNG，单张不超过3MB）</p>
						</label>
						<input type="file" id="imgUpload" name="imgUpload" accept="image/jpeg,image/png" multiple
							onchange="handleImgUpload(this)">

						<!-- 已上传图片预览 -->
						<div class="uploaded-imgs" id="uploadedImgs"></div>
					</div>

					<!-- 新旧程度 -->
					<div class="mb-3">
						<label class="form-label" for="goodsCondition">新旧程度 <span class="text-danger">*</span></label>
						<select class="form-select" id="goodsCondition" required onchange="showConditionDesc()">
							<option value="">请选择新旧程度</option>
							<option value="new">全新：未拆封，无任何使用痕迹</option>
							<option value="95new">95新：几乎无使用痕迹，仅拆封</option>
							<option value="9new">9新：轻微使用痕迹，无明显瑕疵</option>
							<option value="8new">8新：有使用痕迹，轻微瑕疵（如小划痕）</option>
							<option value="7new">7新及以下：明显使用痕迹，多处瑕疵</option>
						</select>
						<div class="condition-desc" id="conditionDesc"></div>
					</div>
				</div>

				<!-- 2. 金额输入模块 -->
				<div class="form-module">
					<h3><i class="fa fa-money"></i> 2. 输入合适的金额</h3>

					<!-- 价格设置（原价+转让价） -->
					<div class="price-group mb-3">
						<div class="form-floating">
							<input type="number" class="form-control" id="originalPrice" step="0.01" min="0"
								placeholder="参考原价，可不填">
							<label for="originalPrice">原价（元）</label>
						</div>
						<div class="form-floating">
							<input type="number" class="form-control" id="transferPrice" step="0.01" min="0.01"
								max="9999.99" required placeholder="转让价（必填）">
							<label for="transferPrice">转让价（元） <span class="text-danger">*</span></label>
						</div>
					</div>
					<div class="form-text">转让价范围：0.01-9999.99元，支持小数点后两位</div>

					<!-- 议价设置（开关） -->
					<div class="bargain-switch mb-3">
						<label class="form-label">可议价</label>
						<div class="form-check form-switch">
							<input class="form-check-input" type="checkbox" id="allowBargain">
						</div>
						<div class="form-text">开启后商品详情页会显示“可议价”标签，买家可发起议价</div>
					</div>
				</div>

				<!-- 3. 发货方式模块 -->
				<div class="form-module">
					<h3><i class="fa fa-truck"></i> 3. 填写发货方式</h3>

					<!-- 交易方式（自提） -->
					<div class="mb-3">
						<label class="form-label">交易方式 <span class="text-danger">*</span></label>
						<div class="form-check">
							<input class="form-check-input" type="radio" name="tradeType" id="selfPick" value="selfPick"
								checked>
							<label class="form-check-label" for="selfPick">自提</label>
						</div>
						<!-- 可扩展：后续可加“校内配送”等选项 -->
					</div>

					<!-- 自提地点 -->
					<div class="mb-3">
						<label class="form-label" for="pickLocation">自提地点 <span class="text-danger">*</span></label>
						<input type="text" class="form-control" id="pickLocation" required
							placeholder="填写校园内具体位置，方便买家找到">
						<div class="form-text">示例：XX食堂门口、XX教学楼1楼大厅</div>
					</div>
				</div>

				<!-- 提交按钮 -->
				<div class="submit-btn-area">
					<button type="submit" class="btn btn-primary submit-btn">
						<i class="fa fa-paper-plane"></i> 发布闲置
					</button>
				</div>
			</form>
		</div>

		<script>
			// 1. 加载二级分类（根据一级分类联动）
			function loadSecondCategory() {
				const firstCategory = document.getElementById("firstCategory").value;
				const secondCategory = document.getElementById("secondCategory");
				// 清空二级分类
				secondCategory.innerHTML = "";
				secondCategory.disabled = false;

				// 根据一级分类加载对应二级分类
				const categoryMap = {
					"textbook": [{
							value: "postgraduate",
							text: "考研资料"
						},
						{
							value: "undergraduate",
							text: "本科教材"
						},
						{
							value: "certificate",
							text: "考证教材"
						},
						{
							value: "reference",
							text: "课外参考书"
						}
					],
					"electronic": [{
							value: "phone",
							text: "手机"
						},
						{
							value: "computer",
							text: "电脑/平板"
						},
						{
							value: "accessory",
							text: "电子配件"
						},
						{
							value: "otherElec",
							text: "其他电子"
						}
					],
					"clothes": [{
							value: "coat",
							text: "外套"
						},
						{
							value: "shirt",
							text: "上衣"
						},
						{
							value: "pants",
							text: "裤子"
						},
						{
							value: "shoe",
							text: "鞋包"
						}
					],
					"daily": [{
							value: "furniture",
							text: "家具"
						},
						{
							value: "kitchen",
							text: "厨房用品"
						},
						{
							value: "toilet",
							text: "卫浴用品"
						},
						{
							value: "otherDaily",
							text: "其他日用"
						}
					],
					"sports": [{
							value: "ball",
							text: "球类"
						},
						{
							value: "fitness",
							text: "健身器材"
						},
						{
							value: "outdoor",
							text: "户外装备"
						},
						{
							value: "otherSports",
							text: "其他运动"
						}
					]
				};

				// 添加二级分类选项
				if (categoryMap[firstCategory]) {
					categoryMap[firstCategory].forEach(item => {
						const option = document.createElement("option");
						option.value = item.value;
						option.text = item.text;
						secondCategory.appendChild(option);
					});
				} else {
					const option = document.createElement("option");
					option.value = "";
					option.text = "请选择二级分类";
					secondCategory.appendChild(option);
				}
			}

			// 2. 重置分类选择
			function resetCategory() {
				document.getElementById("firstCategory").value = "";
				const secondCategory = document.getElementById("secondCategory");
				secondCategory.innerHTML = '<option value="">请先选择一级分类</option>';
				secondCategory.disabled = true;
			}

			// 3. 显示新旧程度说明
			function showConditionDesc() {
				const condition = document.getElementById("goodsCondition").value;
				const descElement = document.getElementById("conditionDesc");
				// 新旧程度说明文本
				const conditionDescMap = {
					"new": "全新：未拆封，无任何使用痕迹",
					"95new": "95新：几乎无使用痕迹，仅拆封",
					"9new": "9新：轻微使用痕迹，无明显瑕疵",
					"8new": "8新：有使用痕迹，轻微瑕疵（如小划痕）",
					"7new": "7新及以下：明显使用痕迹，多处瑕疵"
				};

				if (conditionDescMap[condition]) {
					descElement.textContent = conditionDescMap[condition];
					descElement.style.display = "block";
				} else {
					descElement.style.display = "none";
				}
			}

			// 4. 商品标题字数统计
			document.getElementById("goodsTitle").addEventListener("input", function() {
				const length = this.value.length;
				document.getElementById("titleLength").textContent = `${length}/30`;
				// 超过30字时提示
				if (length > 30) {
					this.classList.add("is-invalid");
					document.getElementById("titleLength").classList.add("text-danger");
				} else {
					this.classList.remove("is-invalid");
					document.getElementById("titleLength").classList.remove("text-danger");
				}
			});

			// 5. 图文描述编辑器：插入格式标签（粗体/斜体/下划线）
			function insertText(startTag, endTag) {
				const editor = document.getElementById("descEditor");
				const startPos = editor.selectionStart;
				const endPos = editor.selectionEnd;
				const selectedText = editor.value.substring(startPos, endPos);
				// 插入标签
				editor.value = editor.value.substring(0, startPos) + startTag + selectedText + endTag + editor.value.substring(
					endPos);
				// 光标定位到标签中间（如果无选中文本）
				if (selectedText === "") {
					editor.selectionStart = editor.selectionEnd = startPos + startTag.length;
				}
				editor.focus();
			}

			// 6. 图片上传处理（预览+删除）
			function handleImgUpload(input) {
				const files = input.files;
				const uploadedImgs = document.getElementById("uploadedImgs");
				// 限制最多上传5张
				if (uploadedImgs.children.length + files.length > 5) {
					alert("最多只能上传5张图片！");
					return;
				}

				for (let i = 0; i < files.length; i++) {
					const file = files[i];
					// 验证文件大小（3MB以内）
					if (file.size > 3 * 1024 * 1024) {
						alert(`${file.name} 超过3MB，请选择更小的图片！`);
						continue;
					}
					// 预览图片
					const reader = new FileReader();
					reader.onload = function(e) {
						const imgItem = document.createElement("div");
						imgItem.className = "uploaded-img-item";
						imgItem.innerHTML = `
		                        <img src="${e.target.result}" alt="商品图片">
		                        <button class="img-delete" onclick="deleteImg(this)"><i class="fa fa-times"></i></button>
		                    `;
						uploadedImgs.appendChild(imgItem);
					};
					reader.readAsDataURL(file);
				}
				// 清空input值，避免重复上传同一文件
				input.value = "";
			}

			// 7. 删除已上传的图片
			function deleteImg(btn) {
				const imgItem = btn.parentElement;
				imgItem.parentElement.removeChild(imgItem);
			}

			// 8. 提交发布表单
			function submitPublish() {
				// 1. 获取表单数据（实际项目中需用FormData收集，包括图片）
				const formData = new FormData(document.getElementById("publishForm"));
				// 2. 基础验证（前端二次确认，避免后端报错）
				const transferPrice = parseFloat(document.getElementById("transferPrice").value);
				if (transferPrice < 0.01 || transferPrice > 9999.99) {
					alert("转让价必须在0.01-9999.99元之间！");
					return false;
				}
				const pickLocation = document.getElementById("pickLocation").value;
				if (pickLocation.trim().length < 5) {
					alert("自提地点请填写校园内具体位置（至少5个字）！");
					return false;
				}
				// 3. 模拟提交（实际项目中替换为AJAX请求）
				alert("闲置发布成功！将跳转到商品列表页～");
				// 跳转首页（或商品详情页）
				window.location.href = "./landing.html";
				// 阻止表单默认提交
				return false;
			}
		</script>
	</body>
</html>